<!DOCTYPE html>
<html>
<head>
  <title>NES</title>
  <script src="jsnes.min.js"></script>
</head>
<body>

<canvas id="screen" width="256" height="240"></canvas>

<!-- MOVE SCRIPT *AFTER* THE CANVAS -->
<script>
  const canvas = document.getElementById("screen");
  const ctx = canvas.getContext("2d");
  const img = ctx.getImageData(0, 0, 256, 240);

  console.log("Canvas OK?", canvas);

  const nes = new jsnes.NES({
    onFrame(frameBuffer) {
      for (let i = 0; i < frameBuffer.length; i++) {
        img.data[i] = frameBuffer[i];
      }
      ctx.putImageData(img, 0, 0);
    }
  });

  fetch("https://raw.githubusercontent.com/maxvorster/maxproject/main/Mario3.nes")
    .then(r => r.arrayBuffer())
    .then(b => {
      nes.loadROM(new Uint8Array(b));
      requestAnimationFrame(function loop() {
        nes.frame();
        requestAnimationFrame(loop);
      });
    });
</script>

</body>
</html>
